name: '99 - Destroy infrastructure'

on: 
    workflow_dispatch:
        inputs:
            confirm_destroy:
                description: 'âš ï¸ Confirmation: Type "DESTROY" to destroy Azure resources'
                required: true
                default: 'NO'

permissions:
    contents: read

jobs:
    destroy:
        runs-on: ubuntu-latest
        environment: Production
        
        if: github.event.inputs.confirm_destroy == 'DESTROY'

        steps:
            - name: ğŸ›‘ Destroy confirmation
              run: echo "Destruction confirmed. All Azure resources will be removed"

            - name: ğŸ“¦ Checkout Code
              uses: actions/checkout@v4

            - name: ğŸ”‘ Azure Login
              uses: azure/login@v1
              with:
                creds: ${{ secrets.AZURE_CREDENTIALS }}
            
            - name: ğŸ› ï¸ Setup Terraform
              uses: hashicorp/setup-terraform@v3

            - name: ğŸ”„ Terraform Init
              working-directory: ./Terraform
              run: terraform init

            - name: ğŸ’¥ Terraform DESTROY 
              working-directory: ./Terraform
              run: terraform destroy -auto-approve tfdestroyplan