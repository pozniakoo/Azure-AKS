name: 'Destroy backend storage'

on: 
    workflow_dispatch:
        inputs:
            confirm_destroy:
                description: 'Wpisz "DESTROY_BACKEND" aby usunÄ…Ä‡ backend'

permissions:
    contents: read

jobs:
    destroy_backend:
        runs-on: ubuntu-latest
        if: github.event.inputs.confirm_destroy == 'DESTROY_BACKEND'
        environment: 'Development'
        steps:
            - name: ğŸ›‘ Destroy confirmation
              run: echo 'Backend destruction confirmed'
            
            - name: ğŸ“¦ Checkout Code
              uses: actions/checkout@v4

            - name: ğŸ”‘ Azure Login
              uses: azure/login@v1
              with:
                creds: ${{ secrets.AZURE_CREDENTIALS }}
            
            - name: ğŸ› ï¸ Setup Terraform
              uses: hashicorp/setup-terraform@v3

            - name: ğŸ”„ Terraform Init
              working-directory: ./backend
              run: terraform init

            - name: ğŸ’¥ Terraform DESTROY backend
              working-directory: ./backend
              run: terraform destroy -var-file="terraform.tfvars" -auto-approve
